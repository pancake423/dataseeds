<head>
    <script src="src/scripts/budgetdataframe.js" type="text/javascript"></script>
    <script src="src/scripts/papaparse.min.js" type="text/javascript"></script>
    <script src="src/scripts/data-page.js" type="text/javascript"></script>
    <script src="src/scripts/config-bar.js" type="text/javascript"></script>
    <script src="src/scripts/codebook-page.js" type="text/javascript"></script>
    <script src="src/scripts/reports-page.js" type="text/javascript"></script>
    <script src="src/scripts/report-url-gen.js" type="text/javascript"></script>
    <script src="src/scripts/index.js" type="text/javascript"></script>
    
    <link href="src/styles/style-data.css" rel="stylesheet"/>
    <link href="src/styles/style-codebook.css" rel="stylesheet"/>
    <link href="src/styles/style-reports.css" rel="stylesheet"/>
    <link href="src/styles/style-main.css" rel="stylesheet"/>
</head>
<body>
    <div id="tab-bar">
        <div class="tab selected" title="Upload data files"><p class="tab-text" onclick="selectTab(0)">Data Files</p></div>
        <div class="tab" title="Choose how the program processes data files"><p class="tab-text" onclick="selectTab(1)">Codebook</p></div>
        <div class="tab" title="Create more complex custom variables on the dataset"><p class="tab-text" onclick="selectTab(2)">Custom Variables</p></div>
        <div class="tab" title="Generate reports"><p class="tab-text" onclick="selectTab(3)">Reports</p></div>
        <div class="tab" title="Generate high resolution graphs"><p class="tab-text" onclick="selectTab(4)">Graphs</p></div>
    </div>
    <div id="page-container">
        <div class="page shown">
            <div id="page-data">
                <div class="d-container">
                    <h2 class="d-header">Add Data Files</h2>
                    <p>Add your raw data files in CSV format for analysis. Excel and Google Sheets both have options to convert .xlsx files to CSV if necessary.</p>
                    <div class="d-spacer"></div>
                    <div id="d-security-note">
                        <h3 class="d-header">Your files are secure <img src="src/assets/lock.svg" class="d-icon" /></h3>
                        <p> This program never uploads, stores, or modifies data files. They are only accessed locally by the browser.</p>
                    </div>
                    <div class="d-spacer"></div>
                    <p><button id="d-upload-button" onclick = "filePickerButtonCSV()">Add files</button> or drag and drop below:</p>
                    <div class="d-spacer"></div>
                    <div id="d-drop-target" ondrop ="dropHandler(event)" ondragover="dragOverHandler(event)"><img src="src/assets/upload.svg" id="d-icon-upload" /></div>
                    <div class="d-warning"><p>Auto Report Generator only supports CSV files.</p></div>
                </div>
                <div class="d-container">
                    <h2 class="d-header">File List</h2>
                    <p>As you add files to the current workspace, they will appear below. click the <img src="src/assets/cross-red.svg" class="d-icon" /> beside a file name to remove it.</p>
                    <div class="d-spacer"></div>
                    <div id="d-file-list" title="File list"></div>
                </div>
            </div>
        </div>
        <div class="page hidden">
            <div id="page-codebook">
                <div id="c-var-cover" class="no-access-bg"><p id="c-cover-text">Select a variable to modify its attributes.</p></div>
                <div id="c-no-config" class="no-access-bg">
                    <div class="popup-box">
                        <div class="d-spacer"></div>
                        <p>Add or create a config file to work on the codebook.</p>
                        <div class="d-spacer"></div>
                    </div>
                </div>
                <div id="c-var-manage" class="c-column">
                    <h2 class="c-header">Manage Variables</h2>
                    <p>Use the buttons below to add or remove variables from the codebook. Click on a variable in the list to modify its properties.</p>
                    <div class="c-horiz-bar" width="100%">
                        <div class="c-horiz-bar">
                            <input id="c-var-name-input" class="c-input" list="c-add-datalist"/>
                            <button class="c-button" onclick="addVariableButton()">add</button>
                        </div>
                        <div class="d-spacer" style="width:2em"></div>
                        <div class="c-horiz-bar">
                            <button class="c-button" onclick="checkAddAllVariables()">add all</button>
                            <button class="c-button" onclick="checkRemoveAllVariables()">remove all</button>
                        </div>
                    </div>
                    <h2 class="c-header">Variable List</h2>
                    <div id="c-var-list" class="c-column c-manage-box"></div>
                </div>
                <div id="c-var-info" class="c-column">
                    <h2 class="c-header">Variable Info</h2>
                    <p>Choose how raw data from the dataset is converted before being displayed. None applies no conversion, Range clamps numeric data, and convert allows
                        1:1 mapping of input (raw data) values to output (display) values.
                    </p>
                    <div class="c-horiz-bar">
                        <p>Conversion Type:</p>
                        <select class="c-input" id="c-conversion-type" onchange="checkChangeConversionType()">
                            <option value="none">None</option>
                            <option value="range">Range</option>
                            <option value="convert">Convert</option>
                        </select></div>
                    <h2 class="c-header">Conversion Table</h2>
                    <div id="c-conv-table" class="c-column c-manage-box"></div>
                    <div class="c-horiz-bar" id="c-conv-buttons">
                        <button class="c-button" onclick="newEntryButton()">new entry</button>
                        <button class="c-button" onclick="autoFillButton()">auto fill</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="page hidden">
            <div id="page-custom">
                <div id="v-no-config" class="no-access-bg">
                    <div class="popup-box">
                        <div class="d-spacer"></div>
                        <p>Add or create a config file to work on custom variables.</p>
                        <div class="d-spacer"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="page hidden">
            <div id="page-reports">
                <div id="r-graph-cover" class="no-access-bg"><p id="c-cover-text">Select a graph to modify its settings.</p></div>
                <div id="r-header-cover" class="no-access-bg"><p id="c-cover-text">Select a header to modify its settings.</p></div>
                <div id="r-no-config" class="no-access-bg">
                    <div class="popup-box">
                        <div class="d-spacer"></div>
                        <p>Add or create a config file to make reports.</p>
                        <div class="d-spacer"></div>
                    </div>
                </div>
                <div id="r-report-structure" class="c-column">
                    <h2>Report Structure</h2>
                    <p>The order in which graphs and report section headers should be displayed. Use the buttons below to add new graphs and headers. Click on a graph or
                        header to modify it. Drag and drop graphs/headers to rearrange.
                    </p>
                    <div class="c-horiz-bar" style="margin-bottom:var(--page-margin)">
                        <button class="c-button" onclick="addGraphItem('Untitled Graph', REPORT_SELECTED)">new graph</button>
                        <button class="c-button" onclick="addHeaderItem('Untitled Header', REPORT_SELECTED)">new header</button>
                    </div>
                    <div id="r-report-list" class="c-column c-manage-box"></div>
                </div>
                <div id="r-graph-settings" class="c-column">
                    <h2>Graph Settings</h2>
                    <p>Choose how the selected graph should be displayed. Text fields (title, subtitle, x axis label, y axis label, and footer) all support HTML tags.</p>
                    <div class="r-list-item">
                        <p>Data Source:</p>
                        <select class="c-input" id="r-data-source" onchange="saveChangesToGraph()"> 

                        </select>
                    </div>
                    <div class="r-list-item">
                        <p>Graph Type:</p>
                        <select class="c-input" id="r-graph-type" onchange="saveChangesToGraph()">
                            <option value="bar">Bar</option>
                            <option value="pie">Pie</option>
                            <option value="scatter">Scatter</option>
                            <option value="line">Line</option>
                        </select>
                    </div>
                    <div class="r-list-item">
                        <p>Title:</p>
                        <input class="c-input" id="r-graph-title" onchange="saveChangesToGraph()">
                    </div>
                    <div class="r-list-item">
                        <p>Subtitle:</p>
                        <input class="c-input" id="r-graph-subtitle" onchange="saveChangesToGraph()">
                    </div>
                    <div class="r-list-item">
                        <p>X Axis Label:</p>
                        <input class="c-input" id="r-x-axis-label" onchange="saveChangesToGraph()">
                    </div>
                    <div class="r-list-item">
                        <p>Y Axis Label:</p>
                        <input class="c-input" id="r-y-axis-label" onchange="saveChangesToGraph()">
                    </div>
                    <div class="r-list-item">
                        <p>Footer:</p>
                        <input class="c-input" id="r-graph-footer" onchange="saveChangesToGraph()">
                    </div>
                </div>
                <div id="r-header-settings" class="c-column">
                    <h2>Header Settings</h2>
                    <p>Headers have a title (large/bold text) and a description (normal text). Both boxes have full support for HTML tags.</p>
                    <div class="r-list-item">
                        <p>Title:</p>
                        <textarea rows="2" cols="30" id="r-header-title" class="r-textarea" onchange="saveChangesToHeader()"></textarea>
                    </div>
                    <div class="r-list-item">
                        <p>description:</p>
                        <textarea rows="6" cols="30" id="r-header-description" class="r-textarea" onchange="saveChangesToHeader()"></textarea>
                    </div>
                    <div class="r-generate-container">
                        <button class="r-chunky-button" onclick="openReport(DF, CODEBOOK, REPORT)"><b>Generate Report</b></button>
                    </div>
                </div>
            </div>
        </div>
        <div class="page hidden">
            <div id="page-graphs">
                <div id="g-no-config" class="no-access-bg">
                    <div class="popup-box">
                        <div class="d-spacer"></div>
                        <p>Add or create a config file to make graphs.</p>
                        <div class="d-spacer"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="icon-attribution">Uicons by <a href="https://www.flaticon.com/uicons">Flaticon</a></div>
    </div>
    <div id="config-container">
        <h2 id="config-title">Config File</h2>
        <button class="config-button" title="New (blank) configuration file" onclick="showConfigPrompt('blank')"><img class="config-button-icon" src="src/assets/square-plus-white.svg"/></button>
        <button class="config-button" title="Auto-generate configuration file (requires data to be uploaded)" onclick="showConfigPrompt('auto')"><img class="config-button-icon" src="src/assets/gear-white.svg"/></button>
        <button class="config-button" title="Add existing configuration file" onclick="showConfigPrompt('existing')"><img class="config-button-icon" src="src/assets/upload-white.svg"/></button>
        <button class="config-button" title="Save current configuration file" onclick="saveCurrentConfig()"><img class="config-button-icon" src="src/assets/download-white.svg"/></button>
        <div class="d-spacer"></div>
        <div class="d-spacer"></div>
    </div>
    <div id="config-status-box">
        <p id="config-status-text" class="red">No configuration file</p>
    </div>
    <div id="d-mismatch-popup" class="no-access-bg hidden">
        <div id="d-mismatch-box" class="popup-box">
            <h2>Column Mismatch</h2>
            <p>At least one of the data files uploaded contains different column names than the others. How do you want the program to handle this?</p>
            <button class="d-mismatch-button" onclick="handleMismatchPopupAction('merge')">Include all columns and fill with blank data where needed</button>
            <button class="d-mismatch-button" onclick="handleMismatchPopupAction('remove')">Remove problematic data files from workspace</button>
            <button title="Will cause data loss" class="d-mismatch-button" onclick="handleMismatchPopupAction('drop')"><img src="src/assets/triangle-warning.svg" class="d-icon" /> Only keep shared column names <img src="src/assets/triangle-warning.svg" class="d-icon" /></button>
            <div class="d-spacer"></div>
        </div>
    </div>
    <div id="global-confirm-popup" class="no-access-bg hidden">
        <div id="global-confirm-box" class="popup-box">
            <h2 id="global-confirm-title"></h2>
            <p id="global-confirm-text"></p>
            <div class="d-spacer"></div>
            <div id="global-button-bar">
                <button class="global-confirm-button accent" onclick="">OK</button>
                <button class="global-confirm-button bg" onclick="">Cancel</button>
            </div>
        </div>
    </div>
    <div class="d-warning hidden" id="global-warning"><p id="global-warning-text"></p></div>
    <datalist id="c-add-datalist"></datalist>
</body>